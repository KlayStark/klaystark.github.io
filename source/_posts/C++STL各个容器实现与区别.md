---
title: C++STL各容器的底层实现与区别
date: 2021-8-03 22:58:50
categories: C++
tags:
---

## vector

底层是一块具有连续内存的数组，vector的核心在于其长度自动可变。

vector的数据结构主要由三个迭代器(指针)来完成：指向首元素的start，指向尾元素的finish和指向内存末端的end_of_storage。

vector的扩容机制是：当目前可用的空间不足时，分配目前空间的两倍或者目前空间加上所需的新空间大小（取较大值），容量的扩张必须经过“重新配置、元素移动、释放原空间”等过程。

## list

底层是一个循环双向链表，链表结点和链表分开独立定义的，结点包含pre、next指针和data数据。

## deque
双向队列，由分段连续空间构成，每段连续空间是一个缓冲区，由一个中控器来控制。

它必须维护一个map指针（中控器指针），还要维护start和finish两个迭代器，指向第一个缓冲区，和最后一个缓冲区。

deque可以在前端或后端进行扩容，这些指针和迭代器用来控制分段缓冲区之间的跳转。

## stack和queue

栈和队列。它们都是由**deque**作为底层容器实现的，他们是一种容器配接器，修改了deque的接口，具有自己独特的性质（此二者也可以用list作为底层实现）。

stack是deque封住了头端的开口，先进后出，queue是deque封住了尾端的开口，先进先出。

## priority_queue

优先队列。是由以vector作为底层容器，以heap作为处理规则，heap的本质是一个完全二叉树。

## set和map

**底层都是由红黑树实现的**。红黑树是一种二叉搜索树，但是它多了一个颜色的属性。

红黑树的性质如下：1）每个结点非红即黑；2）根节点是黑的；3）如果一个结点是红色的，那么它的子节点就是黑色的；4）任一结点到树尾端（NULL）的路径上含有的黑色结点个数必须相同。

通过以上定义的限制，红黑树确保没有一条路径会比其他路径多出两倍以上；因此，红黑树是一种弱平衡二叉树，相对于严格要求平衡的平衡二叉树来说，它的旋转次数少，所以对于插入、删除操作较多的情况下，通常使用红黑树。

### set与map区别

1. map中的元素是key-value（关键字—值）对；set只有关键字没有值（或者说关键字就是值）。

2. set的迭代器是const的，不允许修改值；map能修改值，不能修改键。

3. map支持下标操作，set不支持。map可以用key做下标，map的下标运算符[ ]将关键码作为下标去执行查找，如果关键码不存在，则插入一个具有该关键码和mapped_type类型默认值的元素至map中，因此下标运算符[ ]在map应用中需要慎用，const_map不能用，只希望确定某一个关键值是否存在而不希望插入元素时也不应该使用，mapped_type类型没有默认值也不应该使用。如果find能解决需要，尽可能用find。

